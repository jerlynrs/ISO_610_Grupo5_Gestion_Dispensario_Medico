{% extends 'base_dashboard.html' %}
{% block content %}
<div class="container mt-4">
  <h4>Editar Visita</h4>
  
  <div class="card">
    <div class="card-body">
      <form method="POST" action="{{ url_for('actualizar_visita', id=visita.id) }}">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="paciente_id">Paciente</label>
              <select class="form-control" name="paciente_id" required>
                {% for paciente in pacientes %}
                  <option value="{{ paciente.id }}" {% if paciente.id == visita.paciente_id %}selected{% endif %}>
                    {{ paciente.nombre }} ({{ paciente.cedula }})
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="medico_id">Médico</label>
              <select class="form-control" name="medico_id" required>
                {% for medico in medicos %}
                  <option value="{{ medico.id }}" {% if medico.id == visita.medico_id %}selected{% endif %}>
                    {{ medico.nombre }} - {{ medico.especialidad }}
                  </option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="fecha">Fecha</label>
              <input type="date" class="form-control" name="fecha" value="{{ visita.fecha.strftime('%Y-%m-%d') if visita.fecha else '' }}" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="hora">Hora</label>
              <input type="time" class="form-control" name="hora" value="{{ visita.hora.strftime('%H:%M') if visita.hora else '' }}" required>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="sintomas">Síntomas</label>
          <textarea class="form-control" name="sintomas" rows="3" required>{{ visita.sintomas }}</textarea>
        </div>
        <div class="form-group">
          <label for="medicamento_id">Medicamento (Opcional)</label>
          <select class="form-control" name="medicamento_id">
            <option value="">Sin medicamento</option>
            {% for medicamento in medicamentos %}
              <option value="{{ medicamento.id }}" {% if medicamento.id == visita.medicamento_id %}selected{% endif %}>
                {{ medicamento.descripcion }} - {{ medicamento.dosis }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="form-group">
          <label for="recomendaciones">Recomendaciones</label>
          <textarea class="form-control" name="recomendaciones" rows="3" required>{{ visita.recomendaciones }}</textarea>
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Actualizar</button>
          <a href="{{ url_for('visitas') }}" class="btn btn-secondary">Cancelar</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}